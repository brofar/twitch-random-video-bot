<!DOCTYPE html>
<html>

<head>
    <title>Browser Notification</title>
    <script src="https://cdn.socket.io/4.1.2/socket.io.min.js"
        integrity="sha384-toS6mmwu70G0fw54EGlWWeA4z3dyJ+dlXBtSURSKN4vyRFOcxd3Bzjj/AoOwY+Rg"
        crossorigin="anonymous"></script>
    <style>
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body::after {
            opacity: 0;
        }

        #main {
            display: table;
            vertical-align: middle;
            height: 100%;
            width: 100%;
            text-align: center;
            position: fixed;
        }

        #player {
            width: 100%;
            margin: 0 auto;
            display: table-cell;
            vertical-align: middle;
        }
        /* ----------------------------------------------
        * Generated by Animista on 2021-7-11 12:17:51
        * Licensed under FreeBSD License.
        * See http://animista.net/license for more info. 
        * w: http://animista.net, t: @cssanimista
        * ---------------------------------------------- */
        @-webkit-keyframes scale-out-center{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}100%{-webkit-transform:scale(0);transform:scale(0);opacity:1}}@keyframes scale-out-center{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}100%{-webkit-transform:scale(0);transform:scale(0);opacity:1}}
        @-webkit-keyframes scale-in-center{0%{-webkit-transform:scale(0);transform:scale(0);opacity:1}100%{-webkit-transform:scale(1);transform:scale(1);opacity:1}}@keyframes scale-in-center{0%{-webkit-transform:scale(0);transform:scale(0);opacity:1}100%{-webkit-transform:scale(1);transform:scale(1);opacity:1}}
    
    </style>
</head>

<body>
    <div id="main">
        <div id="player"></div>
    </div>
</body>

<script>
    let vidPlaying = false;
    let vidArray = [];

    // http://crowdforthink.com/blogs/how-to-implement-real-time-notification-using-socketio-and-nodejs

    var socket = io();
    /**
     * Set Default Socket For Show Notification
     * @param {type} data
     * @returns {undefined}
     */
    socket.on('show_notification', async (data) => {
        // add to queue
        vidArray.push(data.path);

        // check if something's playing.
        if (vidPlaying === false) {
            PlayVideos();
        }
    });

    /**
     * Send Node Notification
     * @param {type} title
     * @param {type} message
     * @param {type} icon
     * @returns {undefined}
     */
    function sendNodeNotification() {
        socket.emit('new_notification', {});
    }

    /********************* VIDEO STUFF *********************/
    function PlayVideos() {
        vidPlaying = true;

        var player = document.getElementById('player');
        var video = document.createElement('video');

        // Get first element (and remove it from array)
        video.src = vidArray.shift();

        // Wait for video to be sufficiently buffered.
        video.addEventListener("canplaythrough", function () {
            video.autoplay = true;
            video.play();
            player.appendChild(video);
            player.style.animation = "scale-in-center 0.4s cubic-bezier(0.390, 0.575, 0.565, 1.000) both";
        }, false);

        // Remove the video object when it's done playing.
        video.onended = () => {
            // destroy the video
            video.remove();

            // If there are still videos, play the next.
            if (vidArray.length > 0) {
                PlayVideos();
            } else {
                vidPlaying = false;
            }
        };
    }
</script>
</html>